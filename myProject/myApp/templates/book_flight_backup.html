{% extends 'base.html' %}

{% block content %}
<section class="section">
    <div class="container">
        <h1 class="page-title">Book Flight: {{ flight.flight_number }}</h1>
        
        <div class="booking-container">
            <div class="booking-details">
                <h2>Flight Details</h2>
                <p><strong>Airline:</strong> {{ flight.airline }}</p>
                <p><strong>Flight Number:</strong> {{ flight.flight_number }}</p>
                <p><strong>Route:</strong> {{ flight.origin }} â†’ {{ flight.destination }}</p>
                <p><strong>Departure:</strong> {{ flight.departure_date }} at {{ flight.departure_time }}</p>
                <p><strong>Arrival:</strong> {{ flight.arrival_time }}</p>
                <p><strong>Duration:</strong> {{ flight.duration }}</p>
                <p><strong>Aircraft:</strong> {{ flight.aircraft_type }}</p>
                <p><strong>Baggage:</strong> {{ flight.baggage_allowance }}</p>
                <p><strong>Price:</strong> ${{ flight.price }}</p>
                <p><strong>Available Seats:</strong> <span class="seats-badge">{{ flight.seats_available }} / {{ flight.total_seats }}</span></p>
            </div>
            
            <div class="booking-form-container">
                <h2>Passenger Information</h2>
                <form method="POST" class="booking-form">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" name="name" required value="{{ user.get_full_name }}">
                    </div>
                    
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" required value="{{ user.email }}">
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" name="phone">
                    </div>
                    
                    <div class="form-group">
                        <label>Passport Number</label>
                        <input type="text" name="passport" placeholder="Optional">
                    </div>
                    
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" name="dob">
                    </div>
                    
                    <div class="form-group">
                        <label>Nationality</label>
                        <input type="text" name="nationality" placeholder="Optional">
                    </div>
                    
                    <div class="form-group">
                        <label>Seat Class *</label>
                        <select name="seat_class" required>
                            <option value="economy">Economy</option>
                            <option value="business">Business</option>
                            <option value="first">First Class</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Select Your Seat *</label>
                        <div class="seat-map">
                            <div class="seat-legend">
                                <span><span class="seat available"></span> Available</span>
                                <span><span class="seat booked"></span> Booked</span>
                                <span><span class="seat selected"></span> Selected</span>
                            </div>
                            
                            <div class="seats-container">
                                {% for row in "ABCDEFGHIJKLMNOP" %}
                                    <div class="seat-row">
                                        <span class="row-label">{{ row }}</span>
                                        {% for col in "123456" %}
                                            {% with seat_num=row|add:col %}
                                            <div class="seat {% if seat_num in booked_seats %}booked{% else %}available{% endif %}" 
                                                 data-seat="{{ seat_num }}"
                                                 {% if seat_num not in booked_seats %}onclick="selectSeat('{{ seat_num }}')"{% endif %}>
                                                {{ seat_num }}
                                            </div>
                                            {% endwith %}
                                        {% endfor %}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        <input type="hidden" name="seat_number" id="seat_number" required>
                        <p id="selected-seat-display" class="selected-seat-text"></p>
                    </div>
                    
                    <div class="form-group">
                        <label>Special Requests</label>
                        <textarea name="special_requests" rows="3" placeholder="Meal preferences, wheelchair assistance, etc."></textarea>
                    </div>
                    
                    <button type="submit" class="btn-primary">Confirm Booking</button>
                    <a href="{% url 'flights' %}" class="btn-outline">Cancel</a>
                </form>
            </div>
        </div>
    </div>
</section>

<script>
function selectSeat(seatNumber) {
    document.querySelectorAll('.seat.selected').forEach(seat => {
        seat.classList.remove('selected');
        seat.classList.add('available');
    });
    
    const seatElement = document.querySelector(`[data-seat="${seatNumber}"]`);
    if (seatElement && !seatElement.classList.contains('booked')) {
        seatElement.classList.remove('available');
        seatElement.classList.add('selected');
        document.getElementById('seat_number').value = seatNumber;
        document.getElementById('selected-seat-display').textContent = `Selected Seat: ${seatNumber}`;
    }
}
</script>

<style>
.seat-map {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin: 10px 0;
}

.seat-legend {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    justify-content: center;
}

.seat-legend span {
    display: flex;
    align-items: center;
    gap: 5px;
}

.seats-container {
    max-width: 400px;
    margin: 0 auto;
}

.seat-row {
    display: flex;
    gap: 5px;
    margin-bottom: 5px;
    align-items: center;
}

.row-label {
    width: 30px;
    font-weight: bold;
    text-align: center;
}

.seat {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px 8px 0 0;
    font-size: 11px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.seat.available {
    background: #28a745;
    color: white;
}

.seat.available:hover {
    background: #218838;
    transform: scale(1.1);
}

.seat.booked {
    background: #dc3545;
    color: white;
    cursor: not-allowed;
    opacity: 0.6;
}

.seat.selected {
    background: #007bff;
    color: white;
    transform: scale(1.1);
}

.selected-seat-text {
    margin-top: 10px;
    font-weight: bold;
    color: #007bff;
    text-align: center;
}

.seats-badge {
    background: #007bff;
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-weight: bold;
}
</style>
{% endblock %}
